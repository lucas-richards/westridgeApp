{% extends "training/base_sidepanel.html" %}
{% load crispy_forms_tags %}
{% block content %}

<style>
    .sticky-column {
  position: sticky;
  left: 0;
  z-index: 1;
  background-color: rgb(249,249,249);
}
</style>

{% if user.is_authenticated %}
<h2>Dashboard</h2>
    

    <table class="table table-hover table-responsive" style="font-size: x-small;">
        <thead>
            <tr>
                <th class="sticky-column">Username</th>
                <th>Progress</th>
                {% for certificate in certificates %}
                        <th class="text-center">
                            {{ certificate }}
                        </th>
                {% endfor %}
            
            </tr>
        </thead>
        <tbody>
            {% for row in data %}
                <tr>
                    <td class="sticky-column" style="width: 60px;">
                        {{ row.username }}
                        <div class="d-flex flex-wrap">
                            {% for role in row.roles %}
                                <span style="width: 20px;font-size: 5px;" class="badge bg-secondary text-white">{{ role }}</span>
                            {% endfor %}
                        </div>
                    </td>
                    <td style="max-width: 40px;">{{ row.percentage }}%</td>
                    {% for cert in row.certifications_status %}
                        <td>
                            {% if cert == '+' %}
                            <div class="d-flex justify-content-center align-items-center">
                                <a class="text-secondary">missing</a>
                            </div>
                            {%endif%}
                            {% if cert.id %}
                                <a href="{% url 'training-certification-detail' cert.id %}" class="d-flex justify-content-center align-items-center text-{% if cert.status == 'Completed' %}success{% elif cert.status == 'In Progress' %}warning{% else %}danger{% endif %}">
                                
                                {% if cert.status == 'Completed' %}
                                {{now}}
                                    {% if cert.expiration_date %}
                                        <p class="text-warning">{{ cert.expiration_date|timeuntil }}</p>
                                        
                                        {% if cert.expiration_date|timeuntil == '0 minutes' %}
                                            <p class="text-danger">Expired</p>
                                        {% endif %}
                                    {% else %}
                                    <p>{{cert.completed_date|date:'n/j/Y'}}</p>
                                    {% endif %}
                                {% else %}
                                    <div data-toggle="tooltip" data-placement="right" title="Scheduled: {{ cert.certification.scheudle_date|date:'n/j' }}">
                                        {{ cert.status }}
                                    </div>
                                {% endif %}
                                </a>
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
            
        </tbody>
    </table>

    
    



       
    


{% endif %}
    


{% endblock content %}