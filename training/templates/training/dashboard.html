{% extends "training/tabs_nav.html" %}
{% load crispy_forms_tags %}
{% block content %}

<!-- create two columns -->
<div class="mb-4 row">
    <div class="col-md-6">
        <div class="mt-5 p-3 card " style="height: 400px;">
            <h2 class="mb-4 text-center">Training History</h2>
            <table class="mb-2 table-hover table-bordered text-center" style="font-size: larger;">
                <thead>
                    <tr class="table-secondary">
                        <th>Total Employees</th>
                        <th>100% Trained</th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <td>{{ profiles_count }}</td>
                        <td>95%</td>
                    </tr>
                    
                </tbody>
            </table>
            <div style="height: 200px;width: 300px;">
                <canvas id="myChart2" style="height: 200px;width: 300px;"></canvas>
            </div>
        </div>
        <div class="mt-5 p-3 card " style="height: 400px;">
            <h2 class="mb-4 text-center">Training By Year</h2>
            <div style="height: 300px;">
                <canvas class="p-3" id="myChart"></canvas>
            </div>

        </div>
        
    </div>
    <div class="col-md-6">
        <div class="mt-5 p-3 card " style="height: 400px;">
            <h2 class="mb-4 text-center">Total Training</h2>
            <table class="mb-2 table-hover table-bordered text-center" style="font-size: larger;">
                <thead>
                    <tr class="table-secondary">
                        <th>Total Training</th>
                        <th>Total Training Performed</th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <td>{{ training.total }}</td>
                        <td>{{ total_training_perc }}%</td>
                    </tr>
                    
                </tbody>
            </table>
            <canvas id="myChart3"></canvas>
            
        </div>
        <div class="mt-5 p-3 card " style="height: 400px;">
            <h2 class="mb-4 text-center">Total Retraining</h2>
            <table class="mb-2 table-hover table-bordered text-center" style="font-size: larger;">
                <thead>
                    <tr class="table-secondary">
                        <th>Total Retraining</th>
                        <th>Total Retraining Performed</th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <td>{{ retraining.total }}</td>
                        <td>{{ total_retraining_perc }}%</td>
                    </tr>
                    
                </tbody>
            </table>
            <canvas  id="myChart4"></canvas>
            
        </div>
    </div>
    
    
</div>
    


<!-- dynamic charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const ctx = document.getElementById('myChart');
  
    new Chart(ctx, {
      type: 'pie',
      data: {
          labels: {{ by_year2.x }},
          datasets: [{
              label: 'Trainings',
              data: {{ by_year2.y }},
              borderWidth: 1,
              backgroundColor: [ 'rgba(54, 162, 235, 0.1)','rgba(251, 192, 147, 0.5)','rgba(102, 204, 153, 0.8)', 'rgba(54, 162, 235, 0.3)', 'rgba(54, 100, 235, 0.5)', 'rgba(54, 162, 235, 0.9)', 'rgba(54, 162, 235, 0.7)', 'rgba(54, 162, 235, 0.4)', 'rgba(54, 162, 235, 0.2)', 'rgba(54, 162, 235, 0.6)', 'rgba(54, 162, 235, 0.8)', 'rgba(54, 162, 235, 0.1)', 'rgba(54, 162, 235, 0.3)', 'rgba(54, 162, 235, 0.5)', 'rgba(54, 162, 235, 0.9)', 'rgba(54, 162, 235, 0.7)', 'rgba(54, 162, 235, 0.4)', 'rgba(54, 162, 235, 0.2)', 'rgba(54, 162, 235, 0.6)', 'rgba(54, 162, 235, 0.8)', 'rgba(54, 162, 235, 0.1)', 'rgba(54, 162, 235, 0.3)', 'rgba(54, 162, 235, 0.5)', 'rgba(54, 162, 235, 0.9)', 'rgba(54, 162, 235, 0.7)', 'rgba(54, 162, 235, 0.4)', 'rgba(54, 162, 235, 0.2)', 'rgba(54, 162, 235, 0.6)', 'rgba(54, 162, 235, 0.8)', 'rgba(54, 162, 235, 0.1)', 'rgba(54, 162, 235, 0.3)', 'rgba(54, 162, 235, 0.5)', 'rgba(54, 162, 235, 0.9)', 'rgba(54, 162, 235, 0.7)', 'rgba(54, 162, 235, 0.4)', 'rgba(54, 162, 235, 0.2)', 'rgba(54, 162, 235, 0.6)']
              
            }]
      },
      options: {
          plugins: {
              legend: {
                  display: true, // Display the legend
                  labels: {
                      fontColor: 'black', // Color of text in legend
                      boxWidth: 20, // Width of colored box
                      padding: 20 // Padding between legend elements
                  }
              },
              tooltip: {
                  enabled: true,
              }
          },
          scales: {
              x: {
                  display: false
              },
              y: {
                  display: false
              }
          }
      }
    });
  
    Chart.register({
      id: 'overrideLegendPosition',
      beforeInit: function(chart, args, options) {
          if (chart.config.type === 'pie') {
              chart.options.plugins.legend.position = 'right';
          }
      }
    });
  
    // Creating the second pie chart
    const ctx2 = document.getElementById('myChart2');
  
    new Chart(ctx2, {
        type: 'pie',
        data: {
            labels: ['1 Year or less', '1 to 2 Years', '5 Years or more', 'Others'],
            datasets: [{
                label: 'Trainings',
                data: {{ history2.y }},
                borderWidth: 1,
                backgroundColor: ['rgba(102, 204, 153, 0.8)', 'rgba(251, 192, 147, 0.5)', 'rgba(54, 162, 235, 0.1)', 'rgba(54, 162, 235, 0.3)']
            }]
        },
        options: {
          plugins: {
              legend: {
                  display: true, // Display the legend
                  labels: {
                      fontColor: 'black', // Color of text in legend
                      boxWidth: 20, // Width of colored box
                      padding: 20 // Padding between legend elements
                  }
              },
              tooltip: {
                  enabled: true,
              }
          },
          scales: {
              x: {
                  display: false
              },
              y: {
                  display: false
              }
          }
      }
    });
  
    // Registering the legend position override for the second pie chart
    Chart.register({
      id: 'overrideLegendPosition2',
      beforeInit: function(chart, args, options) {
          if (chart.config.type === 'pie') {
              chart.options.plugins.legend.position = 'right';
          }
      }
    });
  </script>
<script>
  const ctx3 = document.getElementById('myChart3');

  new Chart(ctx3, {
    type: 'bar',
    data: {
        labels: ['Performed', 'Not Performed', 'Overdue'],
        datasets: [{
            label: 'Trainings',
            data: [
                ({{training.performed}} / {{training.total}}) * 100,
                ({{training.not_performed}} / {{training.total}}) * 100,
                ({{training.overdue}} / {{training.total}}) * 100
            ],
            backgroundColor: ['rgba(54, 162, 235, 0.8)', 'rgba(54, 162, 235, 0.1)', 'rgba(54, 162, 235, 0.3)'],
            borderWidth: 1
        }]
    },
    options: {
        indexAxis: 'y',
        scales: {
            x: {
                min: 0,
                max: 100,
                ticks: {
                    stepSize: 20,
                    callback: function(value) {
                        return value + '%';
                    }
                }
            }
        },
        responsive: true,
        plugins: {
            legend: {
                position: 'top'
            }
        }
    }
});
</script>
<script>
  const ctx4 = document.getElementById('myChart4');

  new Chart(ctx4, {
      type: 'bar',
      data: {
          labels: ['Performed', 'Not Performed', 'Overdue'],
          datasets: [{
              label: 'Trainings',
              data: [{{retraining.performed}}/{{retraining.total}}*100, {{retraining.not_performed}}/{{retraining.total}}*100, {{retraining.overdue}}/{{retraining.total}}*100],
              borderWidth: 1,
              backgroundColor: ['rgba(54, 162, 235, 0.8)', 'rgba(54, 162, 235, 0.1)', 'rgba(54, 162, 235, 0.3)']
          }]
      },
      
      options: {
        indexAxis: 'y',
        scales: {
            x: {
                min: 0,
                max: 100,
                ticks: {
                    stepSize: 20,
                    callback: function(value) {
                        return value + '%';
                    }
                }
            }
        },
        responsive: true,
        plugins: {
            legend: {
                position: 'top'
            }
        }
    }
  });
</script>



{% endblock content %}